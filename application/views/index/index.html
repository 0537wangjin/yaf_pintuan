{% extends '/layout.php' %}
{% block content %}
<link rel="stylesheet" href="/assets/css/swiper.min.css"/>
<link rel="stylesheet" href="/assets/css/ch_wsc.css"/>

<header data-am-widget="header" class="am-header ch-header">
    <div class="am-header-left am-header-nav">
        <a href="#" class="ch-city">
            <span class="j-city">{{city}}</span> >
        </a>
    </div>
    <h1 class="am-header-title">
        <img src="/assets/img/ch-logo.png">
    </h1>
    <div class="am-header-right am-header-nav">
        <a href="/search" class="">
            <i class="ch-search"></i>
        </a>
    </div>
</header>

<div class="ch-container">
    <!-- nav导航 -->
    <div class="swiper-container ch-nav">
        <div class="swiper-wrapper">
            <div class="swiper-slide">
                <a class="active" href="/">首页</a>
            </div>
            {% for item in category %}
            <div class="swiper-slide">
                <a href="/index/new?cateid={{item.id}}">{{item.name}}</a>
            </div>
            {% endfor %}
        </div>
    </div>
    <!-- 轮播图 -->
    <div class="swiper-container ch-slider">
        <div class="swiper-wrapper">
            {% for item in ad %}
            <div class="swiper-slide">
                <a href="{{item.url}}"><img src="{{item.imgurl}}"></a>
            </div>
            {% endfor %}
        </div>
        <div class="swiper-pagination"></div>
    </div>
    <!-- 分类 -->
    <ul class="am-avg-sm-4 ch-mid-nav">
        <li>
            <a class="am-block item" href="/index/coupon">
                <img src="/assets/img/ch-nav-1.png">
                <p class="text">领券</p>
            </a>
        </li>
        <li>
            <a class="am-block item j-sign">
                <img src="/assets/img/ch-nav-2.png">
                <p class="text">每日签到</p>
            </a>
        </li>
        <li>
            <a class="am-block item" href="/index/gold">
                <img src="/assets/img/ch-nav-3.png">
                <p class="text">积分兑换</p>
            </a>
        </li>
        <li>
            <a class="am-block item" href="/my/">
                <img src="/assets/img/ch-nav-4.png">
                <p class="text">会员中心</p>
            </a>
        </li>
    </ul>

    <!-- 广告区域 -->
    <div class="ch-ads-wrap">
        <div class="ch-ads-left">
            <a href="/tuan">
                <div class="text">
                    <h4>拼团商品</h4>
                    <p>异域风味 台湾美食</p>
                </div>
                <img src="/assets/img/ch-ads.jpg">
            </a>
        </div>
        <div class="ch-ads-right">
            <div class="item">
                <div class="text">
                    <h4>新品发布</h4>
                    <p>优质新品任你挑</p>
                </div>
                <div class="ch-img-wrap">
                    <img src="/assets/img/ch-ads.jpg">
                </div>
            </div>
            <div class="item">
                <div class="text">
                    <h4>满减专区</h4>
                    <p>新品一折起</p>
                </div>
                <div class="ch-img-wrap">
                    <img src="/assets/img/ch-ads.jpg">
                </div>
            </div>
        </div>
    </div>

    <!-- 推荐 -->
    <div class="ch-recommend-wrap">
        <div class="ch-recommend-top">
            <h2 class="ch-all-title"><span class="text">精选推荐</span></h2>
            <p class="ch-content">精挑细选 诚意满满的推荐</p>
        </div>
        <ul class="ch-recommend-list">
            {% for item in goods %}
            <li>
                <a class="block" href="/index/goods?id={{item.id}}">
                    <div class="img-wrap">
                        <img src="{{item.imgurl}}">
                        {% if item.rush > 0 %}
                        <div class="ch-tg"><span class="ch-tg-price">￥{{item.rushprice}}</span></div>
                        {% endif %}
                    </div>
                    <h4 class="ch-title two-truncate">{{item.name}}</h4>
                    <div class="ch-price">￥{{item.price}} <span class="ch-icon-sort">{{item.secondtype}}</span></div>
                </a>
            </li>
            {%endfor%}
        </ul>
    </div>

    <!-- 签到modal -->
    <div class="am-modal am-modal-confirm ch-sign-modal" id="m-sign">
        <div class="am-modal-dialog">
            <div class="am-modal-hd"><a class="ch-sign-close" data-am-modal-close href="javascript:;"></a></div>
            <div class="am-modal-bd">
                <h4 class="ch-sigh-title">每天签到送积分</h4>
                <ul class="ch-sign-list">
                    <li {% if sign.days> 0 %}class="active"{% endif %}>
                        <div class="ch-score-num">+{{signconfig[0].coins}} <i class="ch-sign-select"></i></div>
                        <span>1天</span>
                    </li>
                    <li {% if sign.days> 1 %}class="active"{% endif %}>
                        <div class="ch-score-num">+{{signconfig[1].coins}} <i class="ch-sign-select"></i></div>
                        <span>2天</span>
                    </li>
                    <li {% if sign.days> 2 %}class="active"{% endif %}>
                        <div class="ch-score-num">+{{signconfig[2].coins}} <i class="ch-sign-select"></i></div>
                        <span>3天</span>
                    </li>
                    <li {% if sign.days> 3 %}class="active"{% endif %}>
                        <div class="ch-score-num">+{{signconfig[3].coins}} <i class="ch-sign-select"></i></div>
                        <span>4天</span>
                    </li>
                    <li {% if sign.days> 4 %}class="active"{% endif %}>
                        <div class="ch-score-num">+{{signconfig[4].coins}} <i class="ch-sign-select"></i></div>
                        <span>5天</span>
                    </li>
                    <li {% if sign.days> 5 %}class="active"{% endif %}>
                        <div class="ch-score-num">+{{signconfig[5].coins}} <i class="ch-sign-select"></i></div>
                        <span>6天</span>
                    </li>
                    <li {% if sign.days> 6 %}class="active"{% endif %}>
                        <div class="ch-score-num">+{{signconfig[6].coins}} <i class="ch-sign-select"></i></div>
                        <span>7天</span>
                    </li>
                </ul>
                <div class="ch-rule">
                    <div class="ch-title"><span>赚钱攻略</span></div>
                    <ol>
                        <li>签到当日获得积分实时累加，不清零；</li>
                        <li>签到当日获得机扥实时累加</li>
                        <li>积分可用来兑换商城礼品，礼品会定期更新</li>
                    </ol>
                </div>
                {% if sign.today > 0 %}
                <a class="ch-sign-btn active" href="javascript:sign()">已签到</a>
                {% else %}
                <a class="ch-sign-btn" href="javascript:sign()">今日签到</a>
                {% endif %}
            </div>
        </div>
    </div>


    <!-- 切换城市 -->
    <div class="am-popup ch-popup" id="m-list">
        <div class="am-popup-inner">
            <div class="am-popup-hd" style="z-index: 999; position: fixed;">
                <div class="am-popup-hd">
                    <a data-am-modal-close href="/index"><i class="arrow-left"></i></a>
                    <h1 class="ch-title">选择城市</h1>
                </div>
            </div>
            <div class="am-popup-bd">
                <!-- 城市列表 -->
                <div class="city-wrap">
                    <div class="city-item">
                        <div class="stick">当前定位</div>
                        <p class="index-0">当前定位</p>
                        <ul class="city-list">
                            <li><a href="javascript:setcity('{{mycity}}')">{{mycity}}</a></li>
                        </ul>
                    </div>
                    <!--<div class="city-item">
                        <div class="stick">#</div>
                        <p class="index-1">热门城市</p>
                        <ul class="city-list">
                            <li><a href="#">北京</a></li>
                            <li><a href="#">上海</a></li>
                            <li><a href="#">深圳</a></li>
                            <li><a href="#">深圳</a></li>
                        </ul>
                    </div>-->
                    {% for item in district %}
                    <div class="city-item">
                        <div class="stick">{{item.charindex}}</div>
                        <p class="index-A">{{item.charindex}}</p>
                        <ul class="city-list">
                            {% for sub in item.city %}
                            <li><a href="javascript:setcity('{{sub.name}}')">{{sub.name}}</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <!-- 首字母列表 -->
        <ul class="alpha-list">
            <li><a data='1' href="javascript:;">#</a></li>
            <li><a data='A' href="javascript:;">A</a></li>
            <li><a data='B' href="javascript:;">B</a></li>
            <li><a data='C' href="javascript:;">C</a></li>
            <li><a data='D' href="javascript:;">D</a></li>
            <li><a data='E' href="javascript:;">E</a></li>
            <li><a data='F' href="javascript:;">F</a></li>
            <li><a data='G' href="javascript:;">G</a></li>
            <li><a data='H' href="javascript:;">H</a></li>
            <li><a data='I' href="javascript:;">I</a></li>
            <li><a data='J' href="javascript:;">J</a></li>
            <li><a data='K' href="javascript:;">K</a></li>
            <li><a data='L' href="javascript:;">L</a></li>
            <li><a data='M' href="javascript:;">M</a></li>
            <li><a data='N' href="javascript:;">N</a></li>
            <li><a data='O' href="javascript:;">O</a></li>
            <li><a data='P' href="javascript:;">P</a></li>
            <li><a data='Q' href="javascript:;">Q</a></li>
            <li><a data='R' href="javascript:;">R</a></li>
            <li><a data='S' href="javascript:;">S</a></li>
            <li><a data='T' href="javascript:;">T</a></li>
            <li><a data='U' href="javascript:;">U</a></li>
            <li><a data='V' href="javascript:;">V</a></li>
            <li><a data='W' href="javascript:;">W</a></li>
            <li><a data='X' href="javascript:;">X</a></li>
            <li><a data='Y' href="javascript:;">Y</a></li>
            <li><a data='Z' href="javascript:;">Z</a></li>
        </ul>
    </div>

</div>

<!--底部导航-->
<div class="am-cf my-navbar">
    <ul class="am-cf am-avg-sm-4">
        <li>
            <a href="#">
                <img src="/assets/img/ch-index.png"/>
                <span>首页</span>
            </a>
        </li>
        <li>
            <a href="#">
                <img src="/assets/img/zb_7.png"/>
                <span>分类</span>
            </a>
        </li>
        <li>
            <a href="#">
                <img src="/assets/img/tt-sc.png"/>
                <span>购物车</span>
            </a>
        </li>
        <li>
            <a href="#">
                <img src="/assets/img/zb_9.png"/>
                <span>个人中心</span>
            </a>
        </li>
    </ul>
</div>
{% include '/navbar.html' %}
{% endblock %}
{% block script %}
<script type="text/javascript" src="/assets/js/swiper.min.js"></script>
<script>
    $(function () {
        var swiper = new Swiper('.ch-nav', {
            slidesPerView: 7,
            paginationClickable: true,
            spaceBetween: 0
        });

        var swiperSlider = new Swiper('.ch-slider', {
            slidesPerView: 'auto',
            pagination: '.swiper-pagination',
            paginationClickable: true,
            spaceBetween: 0
        });


        // 每日签到
        $('.j-sign').on('click', function () {
            $('#m-sign').modal();
        });

        // 签到
        $('.ch-sign-btn').on('click', function () {
            var index;
            $(this).addClass('active').html('已签到');
            $('.ch-sign-list li').each(function () {
                if ($(this).hasClass('active')) {
                    console.log($(this).index());
                    index = $(this).index();
                }
            });

            console.log(index);
            $('.ch-sign-list li').eq(index + 1).addClass('active');
        });


        //切换城市
        //城市列表modal
        $('.ch-city').click(function () {
            $('#m-list').modal();
        });

        //modal显示时执行  
        $('#m-list').on('opened.modal.amui', function () {
            var arr = alphaArr();
            alphaList(arr);
        });

        //选择城市
        $('.city-list a').on('click', function () {
            var text = $(this).text();
            $('.ch-city').find('span').html(text);
            $('#m-list').modal('close');
        });


        //列表中每个字母相对于顶部的距离
        function alphaArr() {
            var arr = [];
            $('.am-popup-inner').find('p').each(function () {
                arr.push($(this).offset().top - 49);
            });
            return arr;
        }

        //点击右侧字母移动到相应位置
        function alphaList() {
            console.log('ok');
            $('.alpha-list').on('click', 'a', function () {
                var data = ($(this).attr('data'));

                var groupElement = $('.index-' + data);
                console.log(groupElement);
                if (groupElement.length > 0) {
                    $('.am-popup-inner').scrollTop(0);
                    var oheight = groupElement.offset().top - 42;
                    var innerHeight = $('.am-popup-inner').scrollTop();
                    console.log(innerHeight);
                    console.log(oheight);
                    var height = oheight - innerHeight;//滚动的距离 = 初始化时到顶部距离减去当前到顶部的距离
                    $('.am-popup-inner').stop().animate({scrollTop: '+=' + height + 'px'});
                } else {
                    return;
                }
            });
        }
    });

    function sign() {
        $.get('/index/sign', function (res) {
            mask(res)
        });
    }
    function setcity(city) {
        $.get('/index/setCity?city='+city, function (res) {
            if (res == 'success'){
                location.href = '/index';
            }else{
                mask(res)
            }
        });
    }
</script>
{% endblock %}